(function(){"use strict";const m=e=>{if(e instanceof HTMLElement)return e;if(typeof e=="string"){const t=document.querySelector(e);return t instanceof HTMLElement?t:null}throw new Error(`Invalid container value. Should be an instance of HTMLElement or a css selector. Received: "${e}"`)};function v(e){let t=e,r=[];function s(l){return r.push(l),()=>{r=r.filter(i=>i!==l)}}function n(){return t}function o(l){t=l;for(const i of r)i(t)}function a(){r=[]}return{subscribe:s,getValue:n,next:o,unsubscribeAll:a}}const G=(e,t)=>Object.is(e,t)||e===t,D=(()=>{let e=null;return{setIframe:t=>{e=t},sendWidgetEvent:t=>{var r;return(r=e==null?void 0:e.contentWindow)==null?void 0:r.postMessage(t,"*")}}})(),S=e=>({stage:"idle",renderQueue:[],renderQueueIndex:0,effectsQueue:[],prevEffects:(e==null?void 0:e.prevEffects)||[],timeout:null}),M={idle:{RENDER:(e,t)=>({...e,stage:"render",renderQueue:[{callback:t.renderCallback,state:"waiting"}],renderQueueIndex:0})},render:{RENDER:(e,t)=>(e.renderQueue.push({callback:t.renderCallback,state:"waiting"}),e),RUN_RENDER_CALLBACK:e=>{const t=e.renderQueue[e.renderQueueIndex];if(!t)throw new Error("RUN_RENDER_CALLBACK called without a waiting render callback");if(t.state!=="waiting")throw new Error("RUN_RENDER_CALLBACK called with a non-waiting render callback");return e.effectsQueue=[],t.state="running",e},EFFECT:(e,t)=>(e.effectsQueue.push(t.effect),e),RENDER_DONE:e=>{const t=e.renderQueue[e.renderQueueIndex];if(!t||t.state!=="running")throw new Error("RENDER_DONE called without a running render callback");return t.state="completed",e.renderQueueIndex+=1,e.renderQueue[e.renderQueueIndex]?e:{...e,stage:"pre_effects",renderQueue:[],renderQueueIndex:0,timeout:null}}},pre_effects:{RENDER:(e,t)=>(e.renderQueue.push({callback:t.renderCallback,state:"waiting"}),e.stage="render",e.timeout!==null&&(clearTimeout(e.timeout),e.timeout=null),e),SET_EFFECTS_TIMEOUT:(e,t)=>(e.timeout=t.timeout,e),RUNNING_EFFECTS:(e,t)=>(e.timeout=t.timeout,e.stage="running_effects",e)},running_effects:{RENDER:(e,t)=>(e.renderQueue.push({callback:t.renderCallback,state:"waiting"}),e),EFFECTS_DONE:e=>(clearTimeout(e.timeout),e.timeout=null,e.renderQueue.length>e.renderQueueIndex?{...e,renderQueue:e.renderQueue,effectQueue:[],currentRenderCallback:null,stage:"render"}:S(e))}},Q=(e,t)=>{var r,s;return t.type==="UNMOUNT"?("timeout"in e&&e.timeout!==null&&clearTimeout(e.timeout),e.timeout=setTimeout(()=>{for(const[n]of e.prevEffects)n()},0),S()):((s=(r=M[e.stage])[t.type])==null?void 0:s.call(r,e,t))||e},K=(e,t)=>{if(!e||e.length!==t.length)return!1;if(e===t)return!0;for(let r=0;r<e.length;r+=1){const s=e[r],n=t[r];if(!(Object.is(s,n)||s===n))return!1}return!0},T=(()=>{let e=S();const t=()=>e,r=n=>{e=Q(t(),n),s()};function s(){const n=t();if(n.stage!=="idle"){if(n.stage==="render"){const o=n.renderQueue[n.renderQueueIndex];if(!o)throw new Error("No more render callbacks in the queue");if(o.state!=="waiting")return;r({type:"RUN_RENDER_CALLBACK"}),o.callback(),r({type:"RENDER_DONE"});return}if(n.stage==="pre_effects"&&n.timeout===null){const o=setTimeout(()=>{r({type:"RUNNING_EFFECTS",timeout:o});const{prevEffects:a,effectsQueue:l}=n;for(let c=a.length;c<l.length;c+=1)a.push([()=>{},null]);if(a.length>l.length)throw new Error("Mismatched effect queue lengths. This is likely due to a conditional hook call.");const i=[];for(let c=0;c<n.effectsQueue.length;c+=1){const d=n.prevEffects[c],u=n.effectsQueue[c];if(d===void 0||!u)throw new Error("Mismatched effect queue lengths. This is likely due to a bug in scheduler module.");const g=d[1],f=u[1];K(g,f)||(d[0](),d[1]=f,i.push([d,u])),n.prevEffects[c]=d}for(let c=0;c<i.length;c+=1){const[d,u]=i[c];d[0]=u[0]()||(()=>{})}r({type:"EFFECTS_DONE"})},0);r({type:"SET_EFFECTS_TIMEOUT",timeout:o})}}}return{render:n=>r({type:"RENDER",renderCallback:n}),effect:n=>r({type:"EFFECT",effect:n}),unmount:()=>r({type:"UNMOUNT"})}})(),x=(e,t)=>{if(!e)return!1;if(e===t)return!0;for(const[r,s]of Object.entries(e))if(!G(s,t[r]))return!1;return!0},V=()=>{let e=null;const t=[],r=()=>{T.unmount();for(const u of t)u()},s=u=>{u!=null&&u.parentElement&&(e||(e=new MutationObserver(()=>{document.body.contains(u)||r()}),e.observe(u.parentElement,{childList:!0})))};t.push(()=>{e&&(e.disconnect(),e=null)});const n=v(),o=u=>{s(u)},a=()=>T.render(()=>{const u=n.getValue();u!=null&&u.container&&m(u.container)&&n.next(u)});return{render:u=>T.render(()=>{const g=n.getValue();if(x(g,u))return;const f=m(u.container);if(!f){r(),console.error("You should create a container for the iframe to render in before calling the render function");return}const w=g?m(g.container):null;f!==w&&(r(),o(f)),n.next(u)}),unmount:r,onlyForHooksAddOnRender:u=>n.subscribe(u),onlyForHooksAddOnUnmount:u=>{t.push(u)},forseRender:a,reset:()=>{r();const u=m(n.getValue().container);u&&(o(u),a())},sendWidgetEvent:D.sendWidgetEvent.bind(window)}},{render:B,onlyForHooksAddOnRender:P,onlyForHooksAddOnUnmount:A,forseRender:b,unmount:j,reset:q,sendWidgetEvent:H}=V(),p=(e,t)=>{T.effect([e,t])},O=(()=>{let e=0,t=[];return P(()=>{e=0}),A(()=>{e=0,t=[]}),s=>{const n=t[e];if(e+=1,n)return n;const o=Array(2).fill(null),a=typeof s=="function"?s():s,l=i=>{if(!t.length){console.error("useStateSDK called on an unmounted app. This is a memory leak and a bug.");return}if(typeof i=="function"){const c=o[0],d=i(c);if(c===d)return;o[0]=d,b();return}i!==o[0]&&(o[0]=i,b())};return o[0]=a,o[1]=l,t.push(o),o}})(),$=e=>{let t=e;return{get:()=>t,set:r=>{t=r}}},h=(e,t)=>{const[r]=O(()=>$({value:e(),prevDeps:t})),{value:s,prevDeps:n}=r.get();if(n.some((o,a)=>t[a]!==o)){const o=e();return r.set({value:o,prevDeps:t}),o}return s},I=e=>e!==null&&typeof e=="object"&&!Array.isArray(e),Y=e=>I(e.payload),W=e=>{if(Y(e)&&"url"in e.payload&&typeof e.payload.url=="string")try{return new URL(e.payload.url),!0}catch{return!1}return!1},N={PW_WIDGET_CLOSE:e=>!0,PW_WIDGET_OPEN_PROFILE_EDIT_PAGE:e=>!0,PW_WIDGET_OPEN_RULES_PAGE:e=>!0,PW_WIDGET_REDIRECT:e=>W(e),PW_WIDGET_REDIRECT_IN_NEW_TAB:e=>W(e),PW_WIDGET_REDIRECT_WITH_POPUP_VALUE:e=>W(e),PW_WIDGET_IFRAME:e=>W(e),TOKEN_REQUEST:e=>!0,PW_WIDGET_IFRAME_LOADER_READY:e=>!0,PW_WIDGET_OPEN_BONUS_PROGRESS:e=>!0},z=e=>{var t;return I(e.data)&&"type"in e.data&&typeof e.data.type=="string"?!!((t=N[e.data.type])!=null&&t.call(N,e.data)):!1},k=(e,t=!1)=>{const r=document.createElement("a");r.setAttribute("rel","noopener noreferrer"),r.setAttribute("href",e),r.setAttribute("target",t?"_blank":"_self"),r.click()},J=(e,t,r)=>{p(()=>{const s=()=>{var o,a;e&&((o=t==null?void 0:t.contentWindow)!=null&&o.postMessage)&&((a=t.contentWindow)==null||a.postMessage({type:"PW_WIDGET_UPDATE_TOKEN",payload:{token:e}},"*"))};s();const n=o=>{if(!z(o))return;const a=o.data;switch(a.type){case"PW_WIDGET_REDIRECT":k(a.payload.url);return;case"PW_WIDGET_REDIRECT_IN_NEW_TAB":k(a.payload.url,!0);return;case"TOKEN_REQUEST":s();return;case"PW_WIDGET_CLOSE":case"PW_WIDGET_OPEN_RULES_PAGE":case"PW_WIDGET_OPEN_PROFILE_EDIT_PAGE":case"PW_WIDGET_REDIRECT_WITH_POPUP_VALUE":case"PW_WIDGET_IFRAME":case"PW_WIDGET_IFRAME_LOADER_READY":case"PW_WIDGET_OPEN_BONUS_PROGRESS":r==null||r(a);break}};return window.addEventListener("message",n),()=>{window.removeEventListener("message",n)}},[r,e,t])},X="/api/user/monitoring/ping";function Z(e){for(const t of document.cookie.split(";")){const[r,s]=t.trim().split("=");if(r===e)return s}return null}const ee=()=>Z("PW_DEV"),E=e=>{if(e==="prod")return"https://paybetget.cash";if(e==="dev"){const t=ee();return t!=null&&t.startsWith("dev")?`https://${t}.paybetget.cash`:"https://dev.paybetget.cash"}if(!e||e==="auto"){const t=document.querySelectorAll("script");for(let s=t.length-1;s>0;s-=1){const n=t[s];if(n.src&&n.src.endsWith("sdk.js"))try{const o=new URL(n.src);if(o.origin.endsWith("paybetget.cash"))return o.hostname.startsWith("dev")?E("dev"):E("prod")}catch{return E("prod")}}const{hostname:r}=window.location;return r.startsWith("dev")||r.startsWith("localhost")||r.startsWith("127.0.0.1")?E("dev"):E("prod")}try{return new URL(e).href}catch{return console.error(`Payment widget SDK received an invalid value for apiVariant. Expected "dev" or "prod" or a valid URL. Received:
`,e,`
Falling back to "prod"`),E("prod")}};function te({brand:e,siteCode:t,widgetType:r,environment:s}){const n=new URL(E(s));return n.searchParams.set("brand",e),n.searchParams.set("siteCode",t),n.searchParams.set("type",r),n.href}const C=e=>h(()=>e?{currency:e,page_type:"widget"}:{page_type:"widget"},[e]);function re(e){const t=E(e);return new URL(X,t).href}const ne=async(e,t=fetch)=>{try{const r=await t(re(e));return!r.status||r.status>=400?[null,new Error(r.statusText||`Monitoring failed with status ${String(r.status)}`)]:[{status:r.status,statusText:r.statusText||""},null]}catch(r){return r instanceof Error?[null,r]:[null,new Error("Failed to fetch monitoring URL with unknown error")]}},oe=({makeGetRequest:e,rstatPushHandler:t,userCurrency:r,environment:s})=>{const n=C(r);p(()=>{let o=!0;return(async()=>{const[l,i]=await ne(s,e);if(o){if(i){t==null||t("fetch_widget_monitoring_failure",{errorMessage:i.message,error:i,...n});return}t==null||t("fetch_widget_monitoring_success",{status:l.status,statusText:l.statusText,...n})}})(),()=>{o=!1}},[n,e,t,s])},U=e=>!!(e.data&&typeof e.data=="object"&&"type"in e.data&&typeof e.data.type=="string"),L=e=>!(I(e.data)&&"payload"in e.data&&I(e.data.payload)&&"url"in e.data.payload&&typeof e.data.payload.url=="string"&&e.data.payload.url),se=e=>!!(U(e)&&e.data.type==="PW_WIDGET_REDIRECT"&&L(e)),ue=e=>!!(U(e)&&e.data.type==="PW_WIDGET_REDIRECT_IN_NEW_TAB"&&L(e)),ae=e=>{p(()=>{if(!e)return;const t=r=>{if(se(r)){window.open(r.data.payload.url,"_self");return}if(ue(r)){const s=document.createElement("a");s.href=r.data.payload.url,s.target="_blank",s.click()}};return window.addEventListener("message",t),()=>{window.removeEventListener("message",t)}},[e])};function F(e){const[t]=O(()=>({current:e}));return t}const ce=(e,t)=>{if(!e)return t;if(e===t)return{};const r={};for(const s of Object.keys(e))e[s]!==t[s]&&(r[s]=t[s]);return r},ie=(()=>{let e=null,t=null,r="";return A(()=>{e==null||e.remove(),e=null,t=null}),n=>{var c,d;const o=ce(t,n);t=n;const{container:a}=n;if(!a){e==null||e.remove(),e=null,(c=n.onSetRef)==null||c.call(n,null);return}const l=te(n);(!e||!a.contains(e))&&(e=a.querySelector(`iframe[src="${l}"`)||document.createElement("iframe"));const i=e;return e.parentElement!==a&&(e==null||e.remove(),e=document.createElement("iframe"),e.title="Payment Widget",e.height="100%",e.width="100%",e.allow="fullscreen; clipboard-read; clipboard-write"),(l!==r||!e.src)&&(r=l,e.src=l),"className"in o&&(e.className=o.className||""),"onLoad"in o&&(e.onload=()=>{var u;e&&((u=n.onLoad)==null||u.call(n,e),e.dataset.loaded="true",b())}),"isVisible"in o&&(o.isVisible?(e.style.position="static",e.style.transform="none",e.style.opacity="1",e.style.pointerEvents="auto"):(e.style.position="absolute",e.style.transform="translate(-1000vw, -1000vh)",e.style.opacity="0",e.style.pointerEvents="none")),i!==e&&(D.setIframe(e),(d=n.onSetRef)==null||d.call(n,e)),a.contains(e)||a.appendChild(e),e}})();P(e=>{const t=F(e.onWidgetEvent);t.current=e.onWidgetEvent;const r=F(e.rstatPushHandler);r.current=e.rstatPushHandler;const s=h(()=>(..._)=>{var R;return(R=r.current)==null?void 0:R.call(r,..._)},[r]),n=C(e.userCurrency),o=h(()=>_=>{var R;(R=t.current)==null||R.call(t,_)},[t]),a={...e,onWidgetEvent:o,rstatPushHandler:s,container:m(e.container)},l=h(()=>y=>{s("iframe_loaded",n),o({type:"IFRAME_LOADED",payload:{iframe:y}})},[o,n,s]),i=h(()=>{let y=null;return _=>{y!==_&&(y=_,o({type:"SET_IFRAME_REF",payload:{iframe:_}}))}},[o]),c=ie({...a,onLoad:l,onSetRef:i}),d=String(c==null?void 0:c.dataset.loaded)==="true",{paymentToken:u,isVisible:g}=a;p(()=>{c&&d&&o({type:"IFRAME_LOADED",payload:{iframe:c}})},[c,d,o]),ae(c),oe(a),J(u,c,o);const f=g&&!!u,{widgetType:w}=a;p(()=>{if(f&&u)return D.sendWidgetEvent({type:"PW_WIDGET_OPEN",payload:{token:u,widgetType:w}});f||D.sendWidgetEvent({type:"PW_WIDGET_CLOSE",payload:null})},[f,c,u,w]),p(()=>{u&&c&&d&&(o==null||o({type:"WIDGET_READY",payload:{iframe:c}}))},[u,c,o,d])});const le={version:"latest",unmount:j,render:B,reset:q,sendWidgetEvent:H};window.paymentWidgetSDK=le,typeof window>"u"&&console.error("SDK is only available in the browser environment. Please run this script in a browser.")})();
//# sourceMappingURL=sdk.js.map
